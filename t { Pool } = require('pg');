                                               Table "public.users"
         Column          |            Type             | Collation | Nullable |              Default              
-------------------------+-----------------------------+-----------+----------+-----------------------------------
 id                      | bigint                      |           | not null | nextval('users_id_seq'::regclass)
 school_id               | bigint                      |           | not null | 1
 person_id               | bigint                      |           | not null | 
 username                | character varying(50)       |           | not null | 
 password_hash           | character varying(255)      |           | not null | 
 role                    | user_role                   |           |          | 'student'::user_role
 status                  | user_status                 |           |          | 'active'::user_status
 email                   | character varying(100)      |           |          | 
 email_verified          | boolean                     |           |          | false
 two_factor_enabled      | boolean                     |           |          | false
 last_login              | timestamp without time zone |           |          | 
 created_at              | timestamp without time zone |           |          | CURRENT_TIMESTAMP
 updated_at              | timestamp without time zone |           |          | CURRENT_TIMESTAMP
 onboarding_completed    | boolean                     |           |          | false
 onboarding_completed_at | timestamp without time zone |           |          | 
Indexes:
    "users_pkey" PRIMARY KEY, btree (id)
    "idx_users_email" btree (email)
    "idx_users_last_activity" btree (last_login)
    "idx_users_onboarding_completed" btree (onboarding_completed, school_id)
    "idx_users_school_status" btree (school_id, status)
    "idx_users_username" btree (username)
    "users_username_key" UNIQUE CONSTRAINT, btree (username)
Foreign-key constraints:
    "fk_users_person" FOREIGN KEY (person_id) REFERENCES people(id) ON DELETE CASCADE
    "fk_users_school" FOREIGN KEY (school_id) REFERENCES schools(id) ON DELETE CASCADE
Referenced by:
    TABLE "assignment" CONSTRAINT "assignment_teacher_fk" FOREIGN KEY (teacher_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "attendance" CONSTRAINT "attendance_recorded_by_fk" FOREIGN KEY (recorded_by) REFERENCES users(id) ON DELETE SET NULL
    TABLE "attendance" CONSTRAINT "attendance_user_fk" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "documents" CONSTRAINT "documents_user_fk" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
    TABLE "file_upload" CONSTRAINT "file_upload_user_fk" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "audit_log" CONSTRAINT "fk_audit_log_user" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "staff_attendance" CONSTRAINT "fk_staff_attendance_user" FOREIGN KEY (marked_by) REFERENCES users(id) ON DELETE SET NULL
    TABLE "student_attendance" CONSTRAINT "fk_student_attendance_user" FOREIGN KEY (marked_by) REFERENCES users(id) ON DELETE SET NULL
    TABLE "lesson" CONSTRAINT "lesson_teacher_fk" FOREIGN KEY (teacher_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "message" CONSTRAINT "message_recipient_fk" FOREIGN KEY (recipient_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "message" CONSTRAINT "message_sender_fk" FOREIGN KEY (sender_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "notification" CONSTRAINT "notification_user_fk" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "onboarding_steps" CONSTRAINT "onboarding_steps_user_fk" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "payment_reminder" CONSTRAINT "payment_reminder_user_fk" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "quiz_attempt" CONSTRAINT "quiz_attempt_student_fk" FOREIGN KEY (student_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "quiz" CONSTRAINT "quiz_teacher_fk" FOREIGN KEY (teacher_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "transactions" CONSTRAINT "transactions_user_fk" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
    TABLE "user_payment_plans" CONSTRAINT "user_payment_plans_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "user_people" CONSTRAINT "user_people_user_fk" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "user_profiles" CONSTRAINT "user_profiles_user_fk" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "user_sessions" CONSTRAINT "user_sessions_user_fk" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    TABLE "user_trials" CONSTRAINT "user_trials_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Triggers:
    trigger_users_updated_at BEFORE UPDATE ON users FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()

